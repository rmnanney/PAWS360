<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>PAWS360 CI/CD Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="/assets/styles.css" />
  </head>
  <body>
    <header>
      <h1>PAWS360 CI/CD Dashboard</h1>
      <p id="last-updated">Loading...</p>
    </header>
    <main>
      <canvas id="usageChart" width="800" height="300"></canvas>
      <pre id="raw-json" style="display:none"></pre>
    </main>

    <script>
      async function loadMetrics() {
        try {
          const r = await fetch('/monitoring/ci-cd-dashboard/data/metrics.json');
          if (!r.ok) throw new Error('Not OK');
          const j = await r.json();
          document.getElementById('last-updated').innerText = 'Last updated: ' + j.last_updated;
          document.getElementById('raw-json').innerText = JSON.stringify(j, null, 2);

          const ctx = document.getElementById('usageChart').getContext('2d');
          const labels = j.by_day.map(d=>d.date);
          const data = {labels, datasets:[{label:'Minutes', data:j.by_day.map(d=>d.minutes)}]};
          new Chart(ctx, {type:'line', data});
        } catch (e) {
          document.getElementById('last-updated').innerText = 'Failed to load metrics';
        }
      }
      loadMetrics();
    </script>
  </body>
</html>
