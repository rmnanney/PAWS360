{
  "info": {
    "name": "PAWS360 UWM Seeder",
    "_postman_id": "paws360-uwm-seeder-collection",
    "description": "One-click seeder to populate buildings, classrooms, users (staff+students), courses, lectures and labs using your existing Spring endpoints.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Full Seeder",
      "item": [
        {
          "name": "Full Seed: Buildings, Classrooms, Courses, Lectures & Labs",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "https://postman-echo.com/get",
              "protocol": "https",
              "host": ["postman-echo","com"],
              "path": ["get"]
            },
            "description": "Runs a pre-request script that seeds buildings, classrooms, users (professor/instructor/TA/students), courses, and sections (lecture + lab). Set environment variable base_url (default http://localhost:8080)."
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "(async () => {",
                  "  const BASE = pm.environment.get('base_url') || 'http://localhost:8080';",
                  "  const TERM = pm.environment.get('seedTerm') || 'Fall';",
                  "  const YEAR = parseInt(pm.environment.get('seedAcademicYear') || '2025', 10);",
                  "  const SUBJECTS = (pm.environment.get('seedSubjects') || 'COMPSCI,MATH,PHYSICS,CHEM,BIO SCI').split(',').map(s=>s.trim()).filter(Boolean);",
                  "  const COURSES_PER_SUBJECT = parseInt(pm.environment.get('seedCoursesPerSubject') || '10', 10);",
                  "  const START_NUMBER = parseInt(pm.environment.get('seedStartNumber') || '101', 10);",
                  "  const DELIVERY_METHOD = pm.environment.get('seedDelivery') || 'IN_PERSON';",
                  "  const LECTURE_CAP = parseInt(pm.environment.get('seedLectureCap') || '40', 10);",
                  "  const LAB_CAP = parseInt(pm.environment.get('seedLabCap') || '20', 10);",
                  "  const WAITLIST_CAP = parseInt(pm.environment.get('seedWaitlistCap') || '10', 10);",
                  "  const CLASSROOMS_PER_BUILDING = parseInt(pm.environment.get('seedClassroomsPerBuilding') || '10', 10);",
                  "  const BUILDINGS = [",
                  "    { code: 'ENGR', name: 'Engineering & Mathematical Sciences', campus: 'Milwaukee', accessible: true, notes: 'Main STEM building' },",
                  "    { code: 'CHEM', name: 'Chemistry Building', campus: 'Milwaukee', accessible: true, notes: '' },",
                  "    { code: 'PHY',  name: 'Physics Building', campus: 'Milwaukee', accessible: true, notes: '' },",
                  "    { code: 'HSS',  name: 'Holton Hall', campus: 'Milwaukee', accessible: true, notes: 'Humanities/Social Sciences' },",
                  "    { code: 'LIB',  name: 'Golda Meir Library', campus: 'Milwaukee', accessible: true, notes: '' }",
                  "  ];",
                  "  const STAFF = [",
                  "    { firstname: 'Dave',  middlename: '', lastname: 'Prof',       email: 'dave.prof@uwm.edu',  role: 'PROFESSOR' },",
                  "    { firstname: 'Ivy',   middlename: '', lastname: 'Instructor', email: 'ivy.inst@uwm.edu',   role: 'INSTRUCTOR' },",
                  "    { firstname: 'Bob',   middlename: '', lastname: 'TA',         email: 'bob.ta@uwm.edu',     role: 'TA' }",
                  "  ];",
                  "  const STUDENTS = [",
                  "    { firstname: 'Alice', middlename: '', lastname: 'Student', email: 'alice.student@uwm.edu' },",
                  "    { firstname: 'Eve',   middlename: '', lastname: 'Pupil',   email: 'eve.pupil@uwm.edu'     },",
                  "    { firstname: 'Tom',   middlename: '', lastname: 'Learner', email: 'tom.learner@uwm.edu'   },",
                  "    { firstname: 'Sara',  middlename: '', lastname: 'Scholar', email: 'sara.scholar@uwm.edu'  },",
                  "    { firstname: 'Liam',  middlename: '', lastname: 'Undergrad', email: 'liam.ug@uwm.edu'     }",
                  "  ];",
                  "  const sleep = ms => new Promise(r => setTimeout(r, ms));",
                  "  const log = (...a) => console.log('[SEEDER]', ...a);",
                  "  async function post(path, body, headers = { 'Content-Type': 'application/json' }) {",
                  "    return new Promise(resolve => {",
                  "      pm.sendRequest({ url: BASE + path, method: 'POST', header: headers, body: { mode: 'raw', raw: JSON.stringify(body) } }, (err, res) => {",
                  "        if (err || !res) return resolve({ ok: false, status: 0, json: null });",
                  "        let data = null; try { data = res.json(); } catch(e) {}",
                  "        resolve({ ok: res.code >= 200 && res.code < 300, status: res.code, json: data });",
                  "      });",
                  "    });",
                  "  }",
                  "  async function get(path) {",
                  "    return new Promise(resolve => {",
                  "      pm.sendRequest({ url: BASE + path, method: 'GET' }, (err, res) => {",
                  "        if (err || !res) return resolve({ ok: false, status: 0, json: null });",
                  "        let data = null; try { data = res.json(); } catch(e) {}",
                  "        resolve({ ok: res.code >= 200 && res.code < 300, status: res.code, json: data });",
                  "      });",
                  "    });",
                  "  }",
                  "  // Buildings",
                  "  const buildingIdByCode = {};",
                  "  for (const b of BUILDINGS) {",
                  "    const body = { code: b.code, name: b.name, campus: b.campus, accessible: !!b.accessible, notes: b.notes || null };",
                  "    const res = await post('/courses/buildings', body);",
                  "    if (!res.ok) { log('Create building failed/duplicate', b.code, res.status); continue; }",
                  "    buildingIdByCode[b.code] = res.json?.id || res.json?.building_id || res.json?.buildingId || res.json?.id;",
                  "    await sleep(20);",
                  "  }",
                  "  log('Buildings:', buildingIdByCode);",
                  "  // Classrooms",
                  "  const classroomIds = [];",
                  "  for (const code of Object.keys(buildingIdByCode)) {",
                  "    const buildingId = buildingIdByCode[code];",
                  "    for (let i = 1; i <= CLASSROOMS_PER_BUILDING; i++) {",
                  "      const room = `${100 + i}`;",
                  "      const body = {",
                  "        buildingId, roomNumber: room, capacity: 24 + (i % 10),",
                  "        roomType: (i % 3 === 0) ? 'COMPUTER_LAB' : 'GENERAL_PURPOSE',",
                  "        features: (i % 3 === 0) ? ['PROJECTOR','COMPUTERS'] : ['PROJECTOR']",
                  "      };",
                  "      const res = await post('/courses/classrooms', body);",
                  "      if (res.ok) classroomIds.push(res.json?.id || res.json?.classroom_id || res.json?.classroomId);",
                  "      await sleep(10);",
                  "    }",
                  "  }",
                  "  log('Classrooms created:', classroomIds.length);",
                  "  // Users",
                  "  async function createUser(u, role) {",
                  "    const body = {",
                  "      firstname: u.firstname, middlename: u.middlename || '', lastname: u.lastname,",
                  "      dob: '1990-01-01', email: u.email, password: 'Password123!',",
                  "      addresses: [{ id: null, address_type: 'HOME', street_address_1: '123 University Ave', street_address_2: '', po_box: '', city: 'Milwaukee', us_states: 'WI', zipcode: '53201' }],",
                  "      countryCode: 'US', phone: '4145550000', status: 'ACTIVE', role",
                  "    };",
                  "    const res = await post('/users/create', body);",
                  "    if (!res.ok) { log('Create user failed', u.email, res.status); return null; }",
                  "    return res.json.user_id;",
                  "  }",
                  "  const staffUserIdByEmail = {};",
                  "  for (const s of STAFF) { const id = await createUser(s, s.role); if (id) staffUserIdByEmail[s.email] = id; await sleep(20);} ",
                  "  const studentUserIdByEmail = {};",
                  "  for (const s of STUDENTS) { const id = await createUser(s, 'STUDENT'); if (id) studentUserIdByEmail[s.email] = id; await sleep(20);} ",
                  "  log('Staff users:', staffUserIdByEmail); log('Student users:', studentUserIdByEmail);",
                  "  // Courses",
                  "  const courses = [];",
                  "  for (const subj of SUBJECTS) {",
                  "    for (let i = 0; i < COURSES_PER_SUBJECT; i++) {",
                  "      const num = START_NUMBER + i;",
                  "      const code = `${subj} ${num}`;",
                  "      const level = String(Math.floor(num / 100) * 100);",
                  "      courses.push({",
                  "        courseCode: code, courseName: `${subj} Course ${num}`, courseDescription: `${subj} auto-seeded course ${num}.`,",
                  "        departmentCode: subj, courseLevel: level, creditHours: (subj==='CHEM'||subj==='PHYSICS')?4.0:3.0,",
                  "        deliveryMethod: DELIVERY_METHOD, active: true, catalogMaxEnrollment: 200, academicYear: YEAR, term: TERM",
                  "      });",
                  "    }",
                  "  }",
                  "  async function upsertCourse(c) { const r = await post('/courses', c); if (!r.ok) { log('Course upsert failed', c.courseCode, r.status); return null; } return r.json?.courseId; }",
                  "  const courseIdByCode = {};",
                  "  for (const c of courses) { const id = await upsertCourse(c); if (id) courseIdByCode[c.courseCode] = id; await sleep(10);} ",
                  "  log('Courses created:', Object.keys(courseIdByCode).length);",
                  "  // Sections",
                  "  function pickRandom(arr){ return arr[Math.floor(Math.random()*arr.length)]; }",
                  "  async function getCourse(courseId){ const r = await get(`/courses/${courseId}`); return r.ok ? r.json : null; }",
                  "  async function upsertSection(req){ const r = await post('/courses/sections', req); if (!r.ok){ log('Section upsert failed', req.courseId, req.sectionType, req.sectionCode, r.status); return null;} return r.json?.sectionId; }",
                  "  async function assignStaff(sectionId, userId, role){ const r = await post('/courses/sections/assign-staff', { sectionId, userId, role }); return !!r.ok; }",
                  "  let lectureCount=0, labCount=0, staffAssigned=0;",
                  "  const professorId = staffUserIdByEmail['dave.prof@uwm.edu'];",
                  "  const instructorId = staffUserIdByEmail['ivy.inst@uwm.edu'];",
                  "  const taId = staffUserIdByEmail['bob.ta@uwm.edu'];",
                  "  for (const code of Object.keys(courseIdByCode)) {",
                  "    const courseId = courseIdByCode[code];",
                  "    const randomBuildingCode = pickRandom(Object.keys(buildingIdByCode));",
                  "    const buildingId = buildingIdByCode[randomBuildingCode];",
                  "    const classroomId = pickRandom(classroomIds);",
                  "    const existing = await getCourse(courseId);",
                  "    // Lecture 001",
                  "    const lectureReq = { sectionId: null, courseId, sectionCode: '001', sectionType: 'LECTURE', parentSectionId: null, buildingId, classroomId, meetingDays: ['MONDAY','WEDNESDAY'], startTime: '09:30:00', endTime: '10:45:00', maxEnrollment: LECTURE_CAP, waitlistCapacity: WAITLIST_CAP, autoEnrollWaitlist: true, consentRequired: false, term: TERM, academicYear: YEAR };",
                  "    if (existing?.sections?.length) { const maybe = existing.sections.find(s => s.sectionType==='LECTURE' && s.sectionCode==='001' && s.term===TERM && s.academicYear===YEAR); if (maybe) lectureReq.sectionId = maybe.sectionId; }",
                  "    const lectureId = await upsertSection(lectureReq); if (lectureId) lectureCount++;",
                  "    if (lectureId && (professorId||instructorId)) { const staffId = professorId || instructorId; if (await assignStaff(lectureId, staffId, professorId?'PROFESSOR':'INSTRUCTOR')) staffAssigned++; }",
                  "    // Labs",
                  "    const labDefs = [ { code: '201', days:['TUESDAY'], start:'11:00:00', end:'12:15:00' }, { code: '202', days:['THURSDAY'], start:'13:00:00', end:'14:15:00' } ];",
                  "    for (const lab of labDefs) {",
                  "      const labReq = { sectionId: null, courseId, sectionCode: lab.code, sectionType: 'LAB', parentSectionId: lectureId, buildingId, classroomId, meetingDays: lab.days, startTime: lab.start, endTime: lab.end, maxEnrollment: LAB_CAP, waitlistCapacity: WAITLIST_CAP, autoEnrollWaitlist: true, consentRequired: false, term: TERM, academicYear: YEAR };",
                  "      if (existing?.sections?.length) { const maybe = existing.sections.find(s => s.sectionType==='LAB' && s.sectionCode===lab.code && s.term===TERM && s.academicYear===YEAR); if (maybe) labReq.sectionId = maybe.sectionId; }",
                  "      const labId = await upsertSection(labReq); if (labId) { labCount++; if (taId && await assignStaff(labId, taId, 'TEACHING_ASSISTANT')) staffAssigned++; }",
                  "      await sleep(10);",
                  "    }",
                  "    await sleep(20);",
                  "  }",
                  "  const summary = { buildings: Object.keys(buildingIdByCode).length, classrooms: classroomIds.length, users: { staff: Object.keys(staffUserIdByEmail).length, students: Object.keys(studentUserIdByEmail).length }, courses: Object.keys(courseIdByCode).length, lectures: lectureCount, labs: labCount, staffAssignments: staffAssigned, term: TERM, year: YEAR };",
                  "  pm.environment.set('seed_summary', JSON.stringify(summary));",
                  "  console.log('[SEEDER] DONE Summary:', summary);",
                  "})().catch(err => console.log('[SEEDER] Uncaught error', err));"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const s = pm.environment.get('seed_summary');",
                  "if (s) { console.log('[SEEDER] Summary', s); pm.test('Seeding finished', function(){ pm.expect(true).to.be.true; }); }",
                  "else { pm.test('Seeding started (async)', function(){ pm.expect(true).to.be.true; }); }"
                ]
              }
            }
          ]
        }
      ]
    }
  ],
  "variable": [
    { "key": "base_url", "value": "http://localhost:8080" },
    { "key": "seedAcademicYear", "value": "2025" },
    { "key": "seedTerm", "value": "Fall" },
    { "key": "seedDelivery", "value": "IN_PERSON" },
    { "key": "seedCoursesPerSubject", "value": "10" },
    { "key": "seedStartNumber", "value": "101" },
    { "key": "seedLectureCap", "value": "40" },
    { "key": "seedLabCap", "value": "20" },
    { "key": "seedWaitlistCap", "value": "10" },
    { "key": "seedClassroomsPerBuilding", "value": "10" },
    { "key": "seedSubjects", "value": "COMPSCI,MATH,PHYSICS,CHEM,BIO SCI" }
  ]
}

